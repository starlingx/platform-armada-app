#
# Copyright (c) 2022 Wind River Systems, Inc.
#
# SPDX-License-Identifier: Apache-2.0
#

nameOverride: rbd-provisioner
fullnameOverride: rbd-provisioner

rbac:
  create: true

provisioner:
  name: rbd-provisioner
  fullnameOverride: rbd-provisioner
  strategy:
    type: Recreate
  priorityClassName:
  nodeSelector: { "node-role.kubernetes.io/control-plane": "" }
  tolerations:
  - key: "node-role.kubernetes.io/control-plane"
    operator: "Exists"
    effect: "NoSchedule"
  - key: "node-role.kubernetes.io/master"
    operator: "Exists"
    effect: "NoSchedule"
  httpMetrics:
    enabled: false
    service:
      enabled: false
  provisioner:
    image:
      repository: k8s.gcr.io/sig-storage/csi-provisioner
      tag: v3.1.0
      pullPolicy: IfNotPresent
    resources: {}

nodeplugin:
  name: rbd-nodeplugin
  nameOverride: rbd-nodeplugin
  fullnameOverride: rbd-nodeplugin
  nodeSelector: { "kubernetes.io/os": "linux" }
  tolerations:
  - operator: "Exists"
  httpMetrics:
    enabled: false
    service:
      enabled: false

serviceAccounts:
  nodeplugin:
    create: true
    name: rbd-nodeplugin
  provisioner:
    create: true
    name: rbd-provisioner

storageClass:
  create: true
  annotations: {
    "storageclass.kubernetes.io/is-default-class": "true",
    "helm.sh/hook": "post-upgrade, post-install",
    "helm.sh/hook-delete-policy": "before-hook-creation"
  }
  mountOptions:
  - discard

topology:
  enabled: false

configMapName: rbd-csiplugin-config
cephConfConfigMapName: rbd-ceph-config

cephconf: |-
  [global]
    auth_cluster_required = none
    auth_service_required = none
    auth_client_required = none

    # Workaround for http://tracker.ceph.com/issues/23446
    fuse_set_user_groups = false

    # ceph-fuse which uses libfuse2 by default has write buffer size of 2KiB
    # adding 'fuse_big_writes = true' option by default to override this limit
    # see https://github.com/ceph/ceph-csi/issues/1928
    fuse_big_writes = true

#
# Defines:
# - Provisioner's image name including container registry.
# - CEPH helper image
#
images:
  tags:
    csi_provisioner: k8s.gcr.io/sig-storage/csi-provisioner:v3.1.0
    csi_snapshotter: k8s.gcr.io/sig-storage/csi-snapshotter:v4.2.0
    csi_attacher: k8s.gcr.io/sig-storage/csi-attacher:v3.4.0
    csi_resizer: k8s.gcr.io/sig-storage/csi-resizer:v1.4.0
    csi_cephcsi: quay.io/cephcsi/cephcsi:v3.6.2
    csi_registrar: k8s.gcr.io/sig-storage/csi-node-driver-registrar:v2.4.0
    rbd_provisioner_storage_init: docker.io/openstackhelm/ceph-config-helper:ubuntu_bionic-20220802
  pull_policy: "IfNotPresent"
  local_registry:
    active: false
    exclude:
      - dep_check
      - image_repo_sync
